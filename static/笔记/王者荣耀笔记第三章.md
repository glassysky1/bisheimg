## 样式

style.stylus

```javascript
// reset
*
  box-sizing border-box
  outline none
html
  font-size 13px
body
  font-family Arial, Helvetica, sans-serif
  margin 0
  line-height 1.2em
  background-color #f1f1f1
  -webkit-font-smoothing antialiased
a
  color #999999
// colors

// scss
// $colors:(
// primary: #db9e3f,
// white: #ffffff,
// light: #f9f9f9,
// grey: #999999,
// dark-1: #333,
// dark: #222222,
// black: #000000
// )

// @each $colorKey,$color in $colors {
// .text-#{$colorKey} {
// color: $color;
// }
// .bg-#{$colorKey}{
// background-color:$color
// }
// }
colors = {
  primary: #db9e3f,
  white: #ffffff,
  light: #f9f9f9,
  grey: #999999,
  grey-1: #666666,
  dark-1: #333,
  dark: #222222,
  black: #000000
}
for colorKey, colorValue in colors
  {'.text-' + colorKey}
    color colorValue
  {'.bg-' + colorKey}
    background-color colorValue
// text

// scss
// @each $var in (left,center,right){
// .text-#{$var}{
// text-align: $var;
// }
// }
for position in 'left' 'center' 'right'
  {'.text-' + position}
    text-align unquote(position)
// font size
// px 2 rem alt z
// scss
// $base-font-size:1rem;
// $font-sizes:(
// xs : 0.7692 ,//10px
// sm:0.9231,///12px
// md:1,//13px
// lg:1.0769,//14px
// xl:1.2308//16px
// )
// @each $sizeKey,$size in $font-sizes {
// .fs-#{$sizeKey}{
// font-size: $size * $base-font-size;
// }
// }
base-font-size = 1rem
font-sizes = {
  xxs:0.6154
  xs: 0.7692,
  sm: 0.9231,
  md: 1,
  lg: 1.0769,
  xl: 1.2308
}
for sizeKey, size in font-sizes
  {'.fs-' + sizeKey}
    font-size size * base-font-size
// flex
.d-flex
  display flex
.flex-colum
  flex-direction column
// scss

// $flex-jc:(
// start:flex-start,
// end:flex-end,
// center:center,
// between:space-between,
// around:space-around
// )

// @each $key,$value in $flex-jc {
// .jc-#{$key}
// justify-content:$value;
// }
// $flex-ai:(
// start:flex-start,
// end:flex-end,
// stretch:strech
// 交叉轴等高
// )

// @each $key,$value in $flex-ai {
// .ai-#{$key}
// align-items:$value;
// }
flex-jc = {
  start: flex-start,
  end: flex-end,
  center: center,
  between: space-between,
  around: space-around
}
for key, value in flex-jc
  {'.jc-' + key}
    justify-content value
flex-ai = {
  start: flex-start,
  end: flex-end,
  center: center,
  stretch: stretch
}
for key, value in flex-ai
  {'.ai-' + key}
    align-items value
.flex-1
  flex 1
// spacing
// 边距
// 0-5:一到五级
// .mt-1 => margin top
// $spacing-types:(m:margin,p:padding);
// $spacing-directions:(t:top,r:right,b:bottom,l:left);
// $spacing-base-size:1rem;
// $spacing-sizes:(
// 0:0,
// 1:0.25,
// 2:0.5,
// 3:1,
// 4:1.5,
// 5:3
// );
// @each $typeKey,$type in $spacing-types{

// @each $directionKey,$direction in $spacing-directions{
// @each $sizeKey,$size in $spacing-sizes{
// //.mt-1{margin-top:0.25rem;}
// .#($typeKey)#{$directionKey}-#{$sizeKey}{
// #{$type}-#{$direction}:$size * $spacing-base-size;
// }
// }
// }
// }
spacing-types = {
  m: margin,
  p: padding
}
spacing-directions = {
  t: top,
  r: right,
  b: bottom,
  l: left
}
spacing-base-size = 1rem
spacing-sizes = {
  '0': 0,
  '1': 0.25,
  '2': 0.5,
  '3': 1,
  '4': 1.5,
  '5': 3
}
for typeKey, type in spacing-types
  // .m-1 {magin:0.25rem}
  for sizeKey, size in spacing-sizes
    {'.' + typeKey + '-' + sizeKey}
      {type} size * spacing-base-size
  // .mx-1
  for sizeKey, size in spacing-sizes
    {'.' + typeKey + 'x-' + sizeKey}
      {type + '-left'} size * spacing-base-size
      {type + '-right'} size * spacing-base-size
  // .my-1
  for sizeKey, size in spacing-sizes
    {'.' + typeKey + 'y-' + sizeKey}
      {type + '-top'} size * spacing-base-size
      {type + '-bottom'} size * spacing-base-size
  // .mt-1 {margin-top:0.25rem}
  for directionKey, direction in spacing-directions
    for sizeKey, size in spacing-sizes
      {'.' + typeKey + directionKey + '-' + sizeKey}
        {type + '-' + direction} size * spacing-base-size

//button
// btn{
//   border:none;
//   border-radius: 0.1538rem;
//   font-size:map-get($font-sizes,'sm')*$base-font-size
// }
.btn
  border none 
  border-radius: 0.1538rem
  font-size font-sizes.sm*base-font-size
  padding 0.2rem 0.6rem

//nav
.nav 
  .nav-item
    border-bottom 3px solid  transparent
    padding-bottom 0.2rem
    &.active
      border-bottom 3px solid  #ffffff
```

asssets/style.styl

```css
@import './_variables.styl'
// reset
*
  box-sizing border-box
  outline none
html
  font-size 13px
body
  font-family Arial, Helvetica, sans-serif
  margin 0
  line-height 1.2em
  background-color #f1f1f1
  -webkit-font-smoothing antialiased
a
  color #999999
for colorKey, colorValue in colors
  {'.text-' + colorKey}
    color colorValue
  {'.bg-' + colorKey}
    background-color colorValue
for position in 'left' 'center' 'right'
  {'.text-' + position}
    text-align unquote(position) !important
for sizeKey, size in font-sizes
  {'.fs-' + sizeKey}
    font-size size * base-font-size
.w-100
  width 100%
.h-100
  width 100%
// flex
.d-flex
  display flex
.flex-colum
  flex-direction column
.flex-wrap
  flex-wrap wrap
for key, value in flex-jc
  {'.jc-' + key}
    justify-content value
for key, value in flex-ai
  {'.ai-' + key}
    align-items value
.flex-1
  flex 1
.text-ellipsis
  display inline-block
  overflow hidden
  text-overflow ellipsis
  white-space nowrap
for typeKey, type in spacing-types
  // .m-1 {magin:0.25rem}
  for sizeKey, size in spacing-sizes
    {'.' + typeKey + '-' + sizeKey}
      {type} size * spacing-base-size
  // .mx-1
  for sizeKey, size in spacing-sizes
    {'.' + typeKey + 'x-' + sizeKey}
      {type + '-left'} size * spacing-base-size
      {type + '-right'} size * spacing-base-size
  // .my-1
  for sizeKey, size in spacing-sizes
    {'.' + typeKey + 'y-' + sizeKey}
      {type + '-top'} size * spacing-base-size
      {type + '-bottom'} size * spacing-base-size
  // .mt-1 {margin-top:0.25rem}
  for directionKey, direction in spacing-directions
    for sizeKey, size in spacing-sizes
      {'.' + typeKey + directionKey + '-' + sizeKey}
        {type + '-' + direction} size * spacing-base-size
.btn
  border none
  border-radius 0.1538rem
  font-size font-sizes.sm * base-font-size
  padding 0.2rem 0.6rem
// nav
.nav
  display flex
  .nav-item
    border-bottom 3px solid transparent
    padding-bottom 0.2rem
    &.active
      border-bottom 3px solid colors.primary
.nav-inverse
  .nav-item
    color colors.white
  &.active
    border-bottom-color colors.white
.sprite
  background url('../images/index.png') no-repeat 0 0
  background-size 28.8462rem
  display inline-block
  &.sprite-news
    width 1.7692rem
    height 1.5385rem
    background-position 63.546% 15.517%
  &.sprite-story
    width 1.7692rem
    height 1.5385rem
    background-position 90.483% 15.614%
  &.sprite-arrow
    width 0.7692rem
    height 0.7692rem
    background-position 38.577% 52.076%
```

assets/_variables.styl

```css
colors = {
  primary: #db9e3f,
  info: #4b67af,
  white: #ffffff,
  light: #f9f9f9,
  light-1: #d4d9de,
  grey: #999999,
  grey-1: #666666,
  dark-1: #333,
  dark: #222222,
  black: #000000
}
border-color = colors.light-1
base-font-size = 1rem
font-sizes = {
  xxs: 0.6154,
  xs: 0.7692,
  sm: 0.9231,
  md: 1,
  lg: 1.0769,
  xl: 1.2308
}
flex-jc = {
  start: flex-start,
  end: flex-end,
  center: center,
  between: space-between,
  around: space-around
}
flex-ai = {
  start: flex-start,
  end: flex-end,
  center: center,
  stretch: stretch
}
spacing-types = {
  m: margin,
  p: padding
}
spacing-directions = {
  t: top,
  r: right,
  b: bottom,
  l: left
}
spacing-base-size = 1rem
spacing-sizes = {
  '0': 0,
  '1': 0.25,
  '2': 0.5,
  '3': 1,
  '4': 1.5,
  '5': 3
}
```



## 主页框架和顶部菜单

router/index.js

```javascript
const routes = [
  {
    path: '/',
    name: 'main',
    component: Main,
    children:[
      { path:'/',name:'home',component:Home},
    ]
  },
]
```

Main.vue//太他妈屌了

```vue
<template>
  <div>
    <div class="topbar bg-black py-2 px-3 d-flex ai-center">
      <img src="../assets/logo.png" height="30" alt />
      <div class="px-2 flex-1">
        <div class="text-white">王者荣耀</div>
        <div class="text-grey-1 fs-xxs">团队贡多成就</div>
      </div>
      <button type="button" class="btn bg-primary">立即下载</button>
    </div>
    <div class="bg-primary pt-3 pb-2">
      <div class="nav d-flex text-white jc-around pb-1">
        <div class="nav-item active">
          <router-link class="nav-link" tag="div" to="/">首页</router-link>
        </div>
        <div class="nav-item">
          <router-link class="nav-link" tag="div" to="/">攻略中心</router-link>
        </div>
        <div class="nav-item">
          <router-link class="nav-link" tag="div" to="/">赛事中心</router-link>
        </div>
      </div>
    </div>
    <router-view></router-view>
  </div>
</template>

<script>
export default {};
</script>

<style>
</style>
```

## 首页

**http://www.spritecow.com/**

Home.vue **引用的时候不要放在rem后面，且不能用scope**

```vue
<template>
  <div class="home">
    <swiper :options="swiperOption">
      <swiper-slide>
        <img class="w-100" src="../assets/images/0_002.jpg" alt />
      </swiper-slide>
      <swiper-slide>
        <img class="w-100" src="../assets/images/0_003.jpg" alt />
      </swiper-slide>
      <swiper-slide>
        <img class="w-100" src="../assets/images/0_004.jpg" alt />
      </swiper-slide>
      <swiper-slide>
        <img class="w-100" src="../assets/images/0_005.jpg" alt />
      </swiper-slide>
      <div class="swiper-pagination px-3 pb-2 pagination-home text-right" slot="pagination"></div>
    </swiper>
    <!-- end of swiper -->
    <div class="nav-icons bg-white mt-3 text-center pt-3 text-dark-1">
      <div class="d-flex flex-wrap">
        <div class="nav-item mb-3" v-for="n in 10" :key="n">
          <i class="sprite sprite-news"></i>
          <div class="py-2">爆料站</div>
        </div>
      </div>
      <div class="bg-light py-2 fs-sm">
        <i class="sprite sprite-arrow mr-1"></i>
        <span>收起</span>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      swiperOption: {
        pagination: {
          el: ".pagination-home"
        }
      }
    };
  }
};
</script>
<style lang="stylus">
@import '../assets/stylus/_variables.styl'
.pagination-home
  .swiper-pagination-bullet
    opacity 1
    background-color colors.white
    border-radius 0.1538rem
    &.swiper-pagination-bullet-active
      background colors.info
.nav-icons
  border-top 1px solid border-color
  border-bottom 1px solid border-color
  .nav-item
    width 25%
    border-right 1px solid border-color
    &:nth-child(4n)
      border-left none 
</style>
```

## 卡片布局

components/Card.vue

```vue
<template>
  <div class="card p-3 bg-white p-3 mt-3">
    <div class="card-header d-flex ai-center pb-3">
      <i class="iconfont" :class="`icon-${icon}`"></i>
      <div class="fs-xl flex-1 px-2">{{title}}</div>
    </div>
    <div class="card-body pt-3">
      <slot></slot>
    </div>
  </div>
</template>

<script>
export default {
  props: {
    title: {
      type: String,
      required: true
    },
    icon: {
      type: String
    }
  }
};
</script>
<style lang="stylus" scoped>
@import '../assets/stylus/_variables'
.card
  .card-header
    border-bottom 1px solid border-color
  border-bottom 1px solid border-color
</style>
```

main.js

```javascript
import Vue from 'vue'
import App from './App.vue'
import router from './router'
import store from './store'
import './registerServiceWorker'
import "./assets/stylus/style.styl"

Vue.config.productionTip = false
import VueAwesomeSwiper from 'vue-awesome-swiper'

// require styles
import 'swiper/dist/css/swiper.css'
import Card from "./components/Card.vue"
//标签名
Vue.component('m-card',Card)
import ListCard from "./components/ListCard.vue"
//标签名
Vue.component('m-list-card',ListCard)

Vue.use(VueAwesomeSwiper)
new Vue({
  router,
  store,
  render: h => h(App)
}).$mount('#app')

```



## 卡片列表(data数组遍历语法)

```vue
<template>
  <!-- end of nav icons -->
  <m-card :icon="icon" :title="title">
    <div class="nav jc-between">
      <div class="nav-item" :class="{'active':active===index}" v-for="(category,index) in categories" :key="index" @click="active=index">
        <div class="nav-link">{{category.name}}</div>
      </div>
    </div>
    <div class="pt-3">
      <swiper>
        <swiper-slide v-for="(category,index) in categories" :key="index">
          <slot name="items" :category="category"></slot>
        </swiper-slide>
      </swiper>
    </div>
  </m-card>
</template>

<script>
export default {
  data(){
    return{
      active:0
    }
  },
  props: {
    icon: {
      type: String
    },
    title: {
      type: String
    },
    categories: {
      type: Array
    }
  }
};
</script>

<style>
</style>
```

Home.vue

```vue
<template>
  <div class="home">
    <swiper :options="swiperOption">
      <swiper-slide>
        <img class="w-100" src="../assets/images/0_002.jpg" alt />
      </swiper-slide>
      <swiper-slide>
        <img class="w-100" src="../assets/images/0_003.jpg" alt />
      </swiper-slide>
      <swiper-slide>
        <img class="w-100" src="../assets/images/0_004.jpg" alt />
      </swiper-slide>
      <swiper-slide>
        <img class="w-100" src="../assets/images/0_005.jpg" alt />
      </swiper-slide>
      <div class="swiper-pagination px-3 pb-2 pagination-home text-right" slot="pagination"></div>
    </swiper>
    <!-- end of swiper -->
    <div class="nav-icons bg-white mt-3 text-center pt-3 text-dark-1">
      <div class="d-flex flex-wrap">
        <div class="nav-item mb-3" v-for="n in 10" :key="n">
          <i class="sprite sprite-news"></i>
          <div class="py-2">爆料站</div>
        </div>
      </div>
      <div class="bg-light py-2 fs-sm">
        <i class="sprite sprite-arrow mr-1"></i>
        <span>收起</span>
      </div>
    </div>

    <!-- end of nav icons -->
    <!-- <m-card icon="menu1" title="新闻资讯">
      <div class="nav jc-between">
        <div class="nav-item active">
          <div class="nav-link">热门</div>
        </div>
        <div class="nav-item">
          <div class="nav-link">新闻</div>
        </div>
        <div class="nav-item">
          <div class="nav-link">热门</div>
        </div>
        <div class="nav-item">
          <div class="nav-link">新闻</div>
        </div>
        <div class="nav-item">
          <div class="nav-link">新闻</div>
        </div>
      </div>
      <div class="pt-3">
        <swiper>
          <swiper-slide v-for="n in 5" :key="n">
            <div class="py-2" v-for="n in 5" :key="n">
              <span>[新闻]</span>
              <span>|</span>
              <span>11月5日全服不停机更新公告</span>
              <span>06/02</span>
            </div>
          </swiper-slide>
        </swiper>
      </div>
    </m-card> -->
    <m-list-card icon="menu-1" title="新闻资讯" :categories="newsCats">
        //新语法
      <template #items="{category}">
        <div class="py-2" v-for="(news,index) in category.newsList" :key="index">
          <span>[{{news.categoryName}}]</span>
          <span>|</span>
          <span>{{news.title}}</span>
          <span>{{news.date}}</span>
        </div>
      </template>
    </m-list-card>
  </div>
</template>

<script>
export default {
  data() {
    return {
      swiperOption: {
        pagination: {
          el: ".pagination-home"
        }
      },
      newsCats: [
        {
          name: "热门",
          newsList: new Array(5).fill({}).map(v => ({
            categoryName: "公告",
            title: "6月2日全服不停机更新公告",
            date: "06/01"
          }))
        },
        {
          name: "新闻",
          newsList: new Array(5).fill({}).map(v => ({
            categoryName: "新闻",
            title: "6月2日全服不停机更新公告",
            date: "06/01"
          }))
        },
        {
          name: "方法",
          newsList: new Array(5).fill({}).map(v => ({
            categoryName: "公告",
            title: "6月2日全服不停机更新公告",
            date: "06/01"
          }))
        },
        {
          name: "等等",
          newsList: new Array(5).fill({}).map(v => ({
            categoryName: "公告",
            title: "6月2日全服不停机更新公告",
            date: "06/01"
          }))
        },
      ]
    };
  }
};
</script>
<style lang="stylus">
@import '../assets/stylus/_variables.styl'
.pagination-home
  .swiper-pagination-bullet
    opacity 1
    background colors.white
    border-radius 0.1538rem
    &.swiper-pagination-bullet-active
      background colors.info
.nav-icons
  border-top 1px solid border-color
  border-bottom 1px solid border-color
  .nav-item
    width 25%
    border-right 1px solid border-color
    &:nth-child(4n)
      border-left none 
</style>
```

## 首页新闻资讯-数据录入(+后台bug修复)

当在编辑页面时点新建页面会没反应，因为el-main的router-view默认是以子路由来区分的，当两个页面用同一个组件就区分不开了，所以

```vue
<router-view :key="$route.path"></router-view>
```

topbar吸顶效果

```css
.topbar
  position sticky
  top 0
  z-index 999
```

/热门包括是综合

$$('.news_list .title').map(el=>el.innerHTML).slice(5)

### 数据库中用到了各种关联

当A模型引用B模型，B模型没有使用过，可能会报错，所以把所有模型引用到db.js

server/plugins/db.js

```shell
cnpm i require-all
```

```javascript
module.exports = app =>{
  const mongoose = require('mongoose')
  mongoose.connect('mongodb://127.0.0.1:27017/node-vue-moba',{
    useNewUrlParser:true,
    useUnifiedTopology: true
  })
  require('require-all')(__dirname + '/../models')
}
```

### 数据库加时间戳(createTime,updateTime)

server/models/Article.js

```javascript
const mongoose = require('mongoose')


const schema = new mongoose.Schema({
  categories: [{ type: mongoose.SchemaTypes.ObjectId, ref:'Category' }],
  title:{type:String},
  body:{type:String}
},{
  timestamps:true//时间戳创建时间
})

//中间件
module.exports = mongoose.model('Article', schema)
```



### (清空,插入数据库)

server/web/index.js

```javascript
module.exports = app => {
  const router = require('express').Router()
  const mongoose = require('mongoose')
  // const Article = mongoose.model('Article')
  const Category = require('../../models/Category')
  const Article = require('../../models/Article')
  //导入新闻数据
  router.get('/news/init', async (req, res) => {
    //找到新闻分类返回的对象
    const parent = await Category.findOne({
      name: '新闻分类'
    })



    // { _id: 5dc232963716663a84a7b32d, name: '新闻分类', __v: 0 }
    //然后找新闻分类下的子分类
    const cats = await Category.find().where({
      parent
    }).lean()//lean比较干净，不掺杂mongoose里面任何东西
    // [
    //   {
    //     _id: 5dc2619329339e2d4ccec463,
    //     name: '新闻',
    //     __v: 0,
    //     parent: 5dc232963716663a84a7b32d
    //   },
    //   {
    //     _id: 5dc2677c92a4821a088ec5f6,
    //     parent: 5dc232963716663a84a7b32d,
    //     name: '公告',
    //     __v: 0
    //   },
    //   {
    //     _id: 5dcbab1c1420745ba4d42046,
    //     parent: 5dc232963716663a84a7b32d,
    //     name: '活动',
    //     __v: 0
    //   },
    //   {
    //     _id: 5dcbab231420745ba4d42047,
    //     parent: 5dc232963716663a84a7b32d,
    //     name: '赛事',
    //     __v: 0
    //   }
    // ]

    const newsTitles = ["西施主打歌《幻纱之灵》即将上线，张靓颖携手KPL明星轰炸斗鱼直播间", "新晋越剧女小生，王者荣耀·上官婉儿全息首演！", "峡谷四美明星集结，给你一个免费COS的机会！", "全民赢官方周边", "“新文创”下的探索与实践：王者荣耀x越剧文化论坛展开跨界对话", "11月12日全服不停机更新公告", "11月12日体验服停机更新公告", "亲密度道具使用异常说明", "11月8日体验服停机更新公告", "11月7日体验服停机更新公告", "KPL季后赛开赛 参与活动送好礼", "告别孤单 浪漫峡谷陪你狂欢 秒杀皮肤限时返场", "感恩有你 李白新星元登场 峡谷全新福利来袭", "【周年许愿树】活动公告", "【周年庆典 明星抽内测】活动公告", "11月13日【比赛服】版本更新公告", "第七届城市赛半决赛晋级队伍诞生，11月23日总决赛即将打响！", "区域联赛校队选拔晋级名单出炉！是时候为校出征啦！", "【KPL今日预报】YTG vs TS，生死一战谁能成功晋级季后赛?", "微赛事专题赛再度开启，为城市荣耀而战！"]
    const newList = newsTitles.map(title => {
      //排序一半对一半
      const randomCats = cats.slice().sort((a, b) => Math.random() - .5)
      return {
        //随便取两个是随机的
        categories: randomCats.slice(0, 2),
        title: title
      }
    })
    //清空数据库
    await Article.deleteMany({})
    await Article.insertMany(newList)
    res.send(newList)
  })
  app.use('/web/api', router)
}
```

## 首页新闻资讯-数据接口(非常重要)

server/models/Category.js

````javascript
const mongoose = require('mongoose')


const schema = new mongoose.Schema({
  name:{type:String},
  //类型是输入里的_id,关联使他本身
  parent:{type: mongoose.SchemaTypes.ObjectId,ref:'Category'}
    //name:'新闻',这是子
    // parent: { _id: "5dc232963716663a84a7b32d", name: "news", __v: 0 }
    // _id: "5dc232963716663a84a7b32d"
    // name: "news"，这是父，其实name都是同一个
    // __v: 0
})

//不懂，保留吧，兴许以后有用
// children关联的是Category,外键是Category里的parent
schema.virtual('children',{
  localField:'_id',
  foreignField:'parent',
  justOne:false,
  ref:'Category'
})
// newsList关联的是Article,外键是Article里的categories
schema.virtual('newsList',{
  localField:'_id',
  foreignField:'categories',
  justOne:false,
  ref:'Article'
})


//中间件
module.exports = mongoose.model('Category',schema)
````

server/web/index.js

```javascript
module.exports = app => {
  const router = require('express').Router()
  const mongoose = require('mongoose')
  // const Article = mongoose.model('Article')
  const Category = require('../../models/Category')
  const Article = require('../../models/Article')
  //导入新闻数据
  router.get('/news/init', async (req, res) => {
    //找到新闻分类返回的对象
    const parent = await Category.findOne({
      name: '新闻分类'
    })



    // { _id: 5dc232963716663a84a7b32d, name: '新闻分类', __v: 0 }
    //然后找新闻分类下的子分类
    const cats = await Category.find().where({
      parent
    }).lean()//lean比较干净，不掺杂mongoose里面任何东西
    // [
    //   {
    //     _id: 5dc2619329339e2d4ccec463,
    //     name: '新闻',
    //     __v: 0,
    //     parent: 5dc232963716663a84a7b32d
    //   },
    //   {
    //     _id: 5dc2677c92a4821a088ec5f6,
    //     parent: 5dc232963716663a84a7b32d,
    //     name: '公告',
    //     __v: 0
    //   },
    //   {
    //     _id: 5dcbab1c1420745ba4d42046,
    //     parent: 5dc232963716663a84a7b32d,
    //     name: '活动',
    //     __v: 0
    //   },
    //   {
    //     _id: 5dcbab231420745ba4d42047,
    //     parent: 5dc232963716663a84a7b32d,
    //     name: '赛事',
    //     __v: 0
    //   }
    // ]

    const newsTitles = ["西施主打歌《幻纱之灵》即将上线，张靓颖携手KPL明星轰炸斗鱼直播间", "新晋越剧女小生，王者荣耀·上官婉儿全息首演！", "峡谷四美明星集结，给你一个免费COS的机会！", "全民赢官方周边", "“新文创”下的探索与实践：王者荣耀x越剧文化论坛展开跨界对话", "11月12日全服不停机更新公告", "11月12日体验服停机更新公告", "亲密度道具使用异常说明", "11月8日体验服停机更新公告", "11月7日体验服停机更新公告", "KPL季后赛开赛 参与活动送好礼", "告别孤单 浪漫峡谷陪你狂欢 秒杀皮肤限时返场", "感恩有你 李白新星元登场 峡谷全新福利来袭", "【周年许愿树】活动公告", "【周年庆典 明星抽内测】活动公告", "11月13日【比赛服】版本更新公告", "第七届城市赛半决赛晋级队伍诞生，11月23日总决赛即将打响！", "区域联赛校队选拔晋级名单出炉！是时候为校出征啦！", "【KPL今日预报】YTG vs TS，生死一战谁能成功晋级季后赛?", "微赛事专题赛再度开启，为城市荣耀而战！"]
    const newList = newsTitles.map(title => {
      //排序一半对一半
      const randomCats = cats.slice().sort((a, b) => Math.random() - .5)
      return {
        //随便取两个是随机的
        categories: randomCats.slice(0, 2),
        title: title
      }
    })
    //清空数据库
    await Article.deleteMany({})
    await Article.insertMany(newList)
    res.send(newList)
  })

  router.get('/news/list', async (req, res) => {
    //populate
    // //找到顶级分类
    // const parent = await Category.findOne({
    //     name:'新闻分类'
    //     //poulate把children找出来，然后再把children里的newslist找出来
    // }).populate({
    //   path:'children',
    //   populate:{
    //     path:'newsList'
    //   }
    // }).lean()//带上关联
    // "_id": "5dc232963716663a84a7b32d",
    //   "name": "新闻分类",
    //     "__v": 0,
    //       "children": [
    //         {
    //           "_id": "5dc2619329339e2d4ccec463",
    //           "name": "新闻",
    //           "__v": 0,
    //           "parent": "5dc232963716663a84a7b32d",
    //           "newsList": [
    //             {
    //               "_id": "5dcbc56a63ab336c5cc169e4",
    //               "categories": [
    //                 "5dcbab231420745ba4d42047",
    //                 "5dc2619329339e2d4ccec463"
    //               ],
    //               "title": "西施主打歌《幻纱之灵》即将上线，张靓颖携手KPL明星轰炸斗鱼直播间",
    //               "__v": 0,
    //               "createdAt": "2019-11-13T08:57:14.434Z",
    //               "updatedAt": "2019-11-13T08:57:14.435Z"
    //             },
    //             {


    //聚合查询
    //先找到顶级分类
    const parent = await Category.findOne({
      name: '新闻分类'
    })
    //聚合查询的参数是聚合管道
    const cats = await Category.aggregate([
      //条件查询,相当于SQLsever里面where
      { $match: { parent: parent._id } },
      {
        // join左外链接
        //把articles遍历出来，并改名newsList
        $lookup: {
          //关联那个集合，是小写复数mongoose.model('Article', schema, articles)
          from: 'articles',
          //主键
          localField: '_id',
          //外键
          foreignField: 'categories',
          // 起个名字
          as: 'newsList'
        }
      },
      {
        $addFields: {
          //改newsList，第一个是要筛的那个字段,第二个是要几个内容
          newsList: { $slice: ['$newsList', 5] }
        }
      }
    ])
    // [
    //   {
    //     "_id": "5dc2619329339e2d4ccec463",
    //     "name": "新闻",
    //     "__v": 0,
    //     "parent": "5dc232963716663a84a7b32d",
    //     "newsList": [
    //       {
    //         "_id": "5dcbf6808f9abe7c8c53a697",
    //         "categories": [
    //           "5dcbab1c1420745ba4d42046",
    //           "5dc2619329339e2d4ccec463"
    //         ],
    //         "title": "西施主打歌《幻纱之灵》即将上线，张靓颖携手KPL明星轰炸斗鱼直播间",
    //         "__v": 0,
    //         "createdAt": "2019-11-13T12:26:40.267Z",
    //         "updatedAt": "2019-11-13T12:26:40.267Z"
    //       },
    //       {
    //         "_id": "5dcbf6808f9abe7c8c53a698",
    //         "categories": [
    //           "5dc2619329339e2d4ccec463",
    //           "5dc2677c92a4821a088ec5f6"
    //         ],
    //         "title": "新晋越剧女小生，王者荣耀·上官婉儿全息首演！",
    //         "__v": 0,
    //         "createdAt": "2019-11-13T12:26:40.268Z",
    //         "updatedAt": "2019-11-13T12:26:40.268Z"
    //       },
    //       {


    const subCats = cats.map(v => v._id)
    cats.unshift({
      name: '热门',
      newsList: await Article.find().where({

        //子分类的id就是在cats里面
        categories: { $in: subCats }
      }).populate('categories').limit(5).lean()
    })

    cats.map(cat =>{
      cat.newsList.map(news =>{
        news.CategoryName = cat.name ==='热门'? news.categories[0].name:cat.name
        return news
      })
      return cat
    })
    res.send(cats)
  })
  app.use('/web/api', router)
}
```

## 新闻资讯(swiper)

ListCard.vue

```vue
<template>
  <!-- end of nav icons -->
  <m-card :icon="icon" :title="title">
    <div class="nav jc-between">
      <div class="nav-item" :class="{'active':active===index}" v-for="(category,index) in categories" :key="index" @click="$refs.list.swiper.slideTo(index)">
        <div class="nav-link">{{category.name}}</div>
      </div>
    </div>
    <div class="pt-3">
      <!-- 把组件的index赋值给active -->
      <swiper ref="list" @slide-change="() => active = $refs.list.swiper.realIndex">
        <swiper-slide v-for="(category,index) in categories" :key="index">
          <slot name="items" :category="category"></slot>
        </swiper-slide>
      </swiper>
    </div>
  </m-card>
</template>

<script>
export default {
  data(){
    return{
      active:0
    }
  },
  props: {
    icon: {
      type: String
    },
    title: {
      type: String
    },
    categories: {
      type: Array
    }
  }
};
</script>

<style>
</style>
```

Home.vue

```vue
<template>
  <div class="home">
    <swiper :options="swiperOption">
      <swiper-slide>
        <img class="w-100" src="../assets/images/0_002.jpg" alt />
      </swiper-slide>
      <swiper-slide>
        <img class="w-100" src="../assets/images/0_003.jpg" alt />
      </swiper-slide>
      <swiper-slide>
        <img class="w-100" src="../assets/images/0_004.jpg" alt />
      </swiper-slide>
      <swiper-slide>
        <img class="w-100" src="../assets/images/0_005.jpg" alt />
      </swiper-slide>
      <div class="swiper-pagination px-3 pb-2 pagination-home text-right" slot="pagination"></div>
    </swiper>
    <!-- end of swiper -->
    <div class="nav-icons bg-white mt-3 text-center pt-3 text-dark-1">
      <div class="d-flex flex-wrap">
        <div class="nav-item mb-3" v-for="n in 10" :key="n">
          <i class="sprite sprite-news"></i>
          <div class="py-2">爆料站</div>
        </div>
      </div>
      <div class="bg-light py-2 fs-sm">
        <i class="sprite sprite-arrow mr-1"></i>
        <span>收起</span>
      </div>
    </div>

    <!-- end of nav icons -->
    <m-list-card icon="menu-1" title="新闻资讯" :categories="newsCats">
      <template #items="{category}">
        <div class="py-2 fs-lg d-flex" v-for="(news,index) in category.newsList" :key="index">
          <span class="text-info">[{{news.categoryName}}]</span>
          <span class="px-2">|</span>
          <span class="flex-1 text-dark-1 text-ellipsis pr-2">{{news.title}}</span>
          <span class="text-grey-1 fs-sm">{{news.createdAt| date}}</span>
        </div>
      </template>
    </m-list-card>
  </div>
</template>

<script>
import dayjs from "dayjs";
export default {
  filters:{
    date(val){
      return dayjs(val).format('MM/DD')
    }
  },
  data() {
    return {
      swiperOption: {
        pagination: {
          el: ".pagination-home"
        }
      },
      newsCats: []
    };
  },
  methods:{
    async fetchNewsCats(){
      const res = await this.$http.get('news/list')
      this.newsCats = res.data
      
    }
  },
  created(){
    this.fetchNewsCats()
  }
};
</script>
<style lang="stylus">
@import '../assets/stylus/_variables.styl'
.pagination-home
  .swiper-pagination-bullet
    opacity 1
    background colors.white
    border-radius 0.1538rem
    &.swiper-pagination-bullet-active
      background colors.info
.nav-icons
  border-top 1px solid border-color
  border-bottom 1px solid border-color
  .nav-item
    width 25%
    border-right 1px solid border-color
    &:nth-child(4n)
      border-left none 
</style>
```

